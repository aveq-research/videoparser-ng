<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>VideoParser: VideoParser – The Next Generation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">VideoParser<span id="projectnumber">&#160;0.2.0</span>
   </div>
   <div id="projectbrief">C++ Video Bitstream Parsing Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('index.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">VideoParser – The Next Generation </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a></p>
<p>A command-line and API-based video bitstream parser, using ffmpeg and other third party libraries.</p>
<ul>
<li>Overview</li>
<li>History and Goals</li>
<li>Installation<ul>
<li>Native Binaries</li>
<li>Docker</li>
</ul>
</li>
<li>Usage</li>
<li>Output</li>
<li>Available Metrics</li>
<li>Building Manually<ul>
<li>Requirements</li>
<li>Installation under macOS</li>
<li>Installation under Ubuntu</li>
<li>Building</li>
<li>Rebuilding ffmpeg</li>
<li>Building with Docker</li>
</ul>
</li>
<li>Developer Guide</li>
<li>Documentation</li>
<li>Acknowledgements</li>
<li>Contributing</li>
<li>License</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md1"></a>
Overview</h1>
<p>This project supplies two main components:</p>
<ul>
<li>A command-line tool for parsing video bitstreams (<span class="tt">video-parser</span>)</li>
<li>A C++ API for parsing video bitstreams, <span class="tt">libvideoparser</span>, which is used by the CLI program</li>
</ul>
<p>The project is aimed at providing input for bitstream-based video (quality) assessment.</p>
<p>Internally, ffmpeg is used, and linked into the project. Currently, the project is built with FFmpeg 8.1-dev (1407 commits from latest release).</p>
<p>We strive to keep the project up to date with the latest ffmpeg version. The actual ffmpeg changes are published in <a href="https://github.com/aveq-research/ffmpeg/tree/videoparser">this <span class="tt">ffmpeg</span> fork</a> in the <span class="tt">videoparser</span> branch.</p>
<p>For AV1 support, libaom is also vendored as a submodule. The code, including its changes, is mirrored at <a href="https://github.com/aveq-research/libaom">this <span class="tt">libaom</span> fork</a> in the <span class="tt">videoparser</span> branch.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2"></a>
History and Goals</h1>
<p>The project is using previous work from the <a href="https://github.com/Telecommunication-Telemedia-Assessment/bitstream_mode3_videoparser"><span class="tt">bitstream_mode3_videoparser</span></a> project, but written from the ground up to be faster.</p>
<p>The overall goal is to provide bitstream statistics to be later used for calculating video quality metrics such as ITU-T Rec. P.1204.3, which has a <a href="https://github.com/Telecommunication-Telemedia-Assessment/bitstream_mode3_p1204_3">reference implementation available</a>.</p>
<p>There are some design docs about this project <a href="https://docs.google.com/document/d/1pnQGDWRjSfff4TyTNWcdeUmCMdCz8crsGo6Ws3rR6W0/edit?tab=t.0">available here</a>. It explains the rationale for the creation of the project, the detailed statistics available in the <span class="tt">bitstream_mode3_videoparser</span> project we'd like to port over, and what we would like to add as features on top of that.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md3"></a>
Installation</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md4"></a>
Native Binaries</h2>
<p>Go to <a href="https://github.com/aveq-research/videoparser-ng/releases">releases</a> and pick the right archive for your platform. Extract it, then run the <span class="tt">video-parser</span> binary.</p>
<p><b>Note for macOS:</b> You might need to allow the binary to run. Try running it once from the Terminal, and you will run into a security notice. Then, go to <em>System Preferences &gt; Security &amp; Privacy &gt; General</em>, and allow the binary. After that, you can run it from the Terminal again.</p>
<p>Continue with this guide to build from source.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md5"></a>
Docker</h2>
<p>We provide a pre-built Docker image on GitHub Container Registry. You can use it without building it yourself.</p>
<p>To pull the image, you need to have a valid GitHub token with access to the repository. If you don't have a token, <a href="https://github.com/settings/tokens">create one here</a>, and make sure it has <span class="tt">read:packages</span> scope enabled.</p>
<div class="fragment"><div class="line">docker login ghcr.io</div>
</div><!-- fragment --><p>You will be prompted to enter your GitHub username, and as password, enter your personal access token. Once you have a token, you can pull the image, and rename it to <span class="tt">videoparser-ng</span> for easier use.</p>
<div class="fragment"><div class="line">docker pull ghcr.io/aveq-research/videoparser-ng:master</div>
<div class="line">docker image tag ghcr.io/aveq-research/videoparser-ng:master videoparser-ng</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md6"></a>
Usage</h1>
<p>To run the CLI, run:</p>
<div class="fragment"><div class="line">build/VideoParserCli/video-parser &lt;path-to-video-file&gt;</div>
</div><!-- fragment --><p>Or, for Docker, you must mount the video file into the container, e.g. to run it on <span class="tt">test/test_video_h264.mkv</span>, do:</p>
<div class="fragment"><div class="line">docker run --rm -it -v $(pwd)/test/test_video_h264.mkv:/video.mkv videoparser-ng /video.mkv</div>
</div><!-- fragment --><p>Add the option <span class="tt">-h</span> for detailed usage.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md7"></a>
Output</h1>
<p>The tool will print a set of line-delimited JSON records to STDOUT, either for per-sequence statistics, or per-frame statistics. These are denoted with the <span class="tt">type</span> field.</p>
<p>Example, but formatted with <span class="tt">jq</span> to make it more readable:</p>
<div class="fragment"><div class="line">build/VideoParserCli/video-parser test/test_video_h264.mkv -n 1 | jq</div>
</div><!-- fragment --><p>This would print:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;type&quot;: &quot;sequence_info&quot;,</div>
<div class="line">  &quot;video_bit_depth&quot;: 8,</div>
<div class="line">  &quot;video_bitrate&quot;: 0.0,</div>
<div class="line">  &quot;video_codec&quot;: &quot;h264&quot;,</div>
<div class="line">  &quot;video_codec_level&quot;: 52,</div>
<div class="line">  &quot;video_codec_profile&quot;: 100,</div>
<div class="line">  &quot;video_duration&quot;: 10.0,</div>
<div class="line">  &quot;video_frame_count&quot;: 0,</div>
<div class="line">  &quot;video_framerate&quot;: 60.0,</div>
<div class="line">  &quot;video_height&quot;: 2160,</div>
<div class="line">  &quot;video_pix_fmt&quot;: &quot;yuv420p&quot;,</div>
<div class="line">  &quot;video_width&quot;: 3840</div>
<div class="line">}</div>
<div class="line">{</div>
<div class="line">  &quot;dts&quot;: 0.0,</div>
<div class="line">  &quot;frame_idx&quot;: 0,</div>
<div class="line">  &quot;frame_type&quot;: 1,</div>
<div class="line">  &quot;is_idr&quot;: true,</div>
<div class="line">  &quot;pts&quot;: 0.0,</div>
<div class="line">  &quot;qp_avg&quot;: 25.0,</div>
<div class="line">  &quot;qp_bb_avg&quot;: 25.0,</div>
<div class="line">  &quot;qp_bb_stdev&quot;: 7.54983443527075,</div>
<div class="line">  &quot;qp_init&quot;: 19,</div>
<div class="line">  &quot;qp_max&quot;: 42,</div>
<div class="line">  &quot;qp_min&quot;: 15,</div>
<div class="line">  &quot;qp_stdev&quot;: 7.54983443527075,</div>
<div class="line">  &quot;size&quot;: 19261,</div>
<div class="line">  &quot;type&quot;: &quot;frame_info&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The tool will also print various logs to STDERR which you can redirect to a file if you want to save them, or ignore with <span class="tt">2&gt;/dev/null</span>.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md8"></a>
Available Metrics</h1>
<p>The following metadata/metrics are available:</p>
<ul>
<li>Per-sequence (type: <span class="tt">sequence_info</span>):<ul>
<li>Video codec</li>
<li>Video codec profile</li>
<li>Video codec level</li>
<li>Video width</li>
<li>Video height</li>
<li>Video pixel format</li>
<li>Video bit depth</li>
<li>Video frame rate</li>
<li>Video duration</li>
<li>Video frame count</li>
<li>Video bitrate</li>
</ul>
</li>
<li>Per-frame data (type: <span class="tt">frame_info</span>):<ul>
<li>Frame type</li>
<li>Frame size</li>
<li>Frame PTS</li>
<li>Frame DTS</li>
<li>Frame index</li>
<li>Frame is IDR</li>
<li>Other, specific per-frame metrics are being implemented at the moment, see <a class="el" href="d0/dc5/md_DEVELOPERS.html">DEVELOPERS.md</a> for more details.</li>
</ul>
</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md9"></a>
Building Manually</h1>
<p>Follow the instructions below to build the project from source.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md10"></a>
Requirements</h2>
<ul>
<li>Ubuntu 22.04 or higher, or macOS 12.0 or higher</li>
<li>CMake 3.15 or higher</li>
<li>A C++17 compiler (GCC 9.3 or higher, Clang 10.0 or higher)</li>
</ul>
<p>You also need:</p>
<ul>
<li><span class="tt">pkg-config</span></li>
<li><span class="tt">ninja-build</span></li>
</ul>
<p>Note that you can skip the build step by just using the pre-built Docker image.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md11"></a>
Installation under macOS</h2>
<p>Xcode is required to compile software on your Mac. Install Xcode by ​downloading it from the website or using the Mac App Store.</p>
<p>After installing Xcode, install the Command Line Tools from Preferences &gt; Downloads &gt; Components. You can also install the tools via your shell:</p>
<div class="fragment"><div class="line">xcode-select --install</div>
</div><!-- fragment --><p>Then, using <a href="https://brew.sh">Homebrew</a>, install the required packages:</p>
<div class="fragment"><div class="line">brew install \</div>
<div class="line">  cmake ninja pkg-config \</div>
<div class="line">  automake git libtool sdl shtool texi2html wget nasm</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md12"></a>
Installation under Ubuntu</h2>
<div class="fragment"><div class="line">sudo apt install \</div>
<div class="line">  autoconf \</div>
<div class="line">  automake \</div>
<div class="line">  build-essential \</div>
<div class="line">  cmake \</div>
<div class="line">  git-core \</div>
<div class="line">  libsdl2-dev \</div>
<div class="line">  libtool \</div>
<div class="line">  libunistring-dev \</div>
<div class="line">  meson \</div>
<div class="line">  ninja-build \</div>
<div class="line">  pkg-config \</div>
<div class="line">  texinfo \</div>
<div class="line">  wget \</div>
<div class="line">  yasm \</div>
<div class="line">  nasm \</div>
<div class="line">  zlib1g-dev \</div>
<div class="line">  libbz2-dev</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md13"></a>
Building</h2>
<p>First clone all submodules:</p>
<div class="fragment"><div class="line">git submodule update --init --recursive</div>
</div><!-- fragment --><p>Then build ffmpeg initially:</p>
<div class="fragment"><div class="line">util/build-ffmpeg.sh</div>
</div><!-- fragment --><p>Then run the build script for the project:</p>
<div class="fragment"><div class="line">util/build-cmake.sh</div>
</div><!-- fragment --><p>This will create the library: <span class="tt">build/VideoParser/libvideoparser.a</span></p>
<p>You can also run the CLI:</p>
<div class="fragment"><div class="line">build/VideoParserCli/video-parser</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md14"></a>
Rebuilding ffmpeg</h2>
<p>If you get a warning like:</p>
<div class="fragment"><div class="line">WARNING: libavcodec/allcodecs.c newer than config_components.h, rerun configure</div>
</div><!-- fragment --><p>Then run:</p>
<div class="fragment"><div class="line">util/build-ffmpeg.sh --reconfigure</div>
</div><!-- fragment --><p>This will rebuild ffmpeg after which you can run the build script for the project again.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md15"></a>
Building with Docker</h2>
<p>To build the project with Docker, run:</p>
<div class="fragment"><div class="line">docker build -t videoparser-ng .</div>
</div><!-- fragment --><p>This will build the project and create a Docker image named <span class="tt">videoparser-ng</span>.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md16"></a>
Developer Guide</h1>
<p>We have a more detailed guide for testing and the specific features implemented. See <a class="el" href="d0/dc5/md_DEVELOPERS.html">DEVELOPERS.md</a>.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md17"></a>
Documentation</h1>
<p>API documentation can be generated using Doxygen:</p>
<div class="fragment"><div class="line">util/generate-docs.sh</div>
</div><!-- fragment --><p>This requires <span class="tt">doxygen</span> to be installed. For better diagrams, also install <span class="tt">graphviz</span>:</p>
<div class="fragment"><div class="line"># macOS</div>
<div class="line">brew install doxygen graphviz</div>
<div class="line"> </div>
<div class="line"># Ubuntu</div>
<div class="line">sudo apt-get install doxygen graphviz</div>
</div><!-- fragment --><p>After generation, open <span class="tt">docs/html/index.html</span> in your browser. On macOS, you can use:</p>
<div class="fragment"><div class="line">util/generate-docs.sh --open</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md18"></a>
Acknowledgements</h1>
<p>If you use this project in your research, please reference this repository.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md19"></a>
Contributing</h1>
<p>See CONTRIBUTING.md.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md20"></a>
License</h1>
<p>Copyright (c) AVEQ GmbH. Copyright (c) videoparser-ng contributors.</p>
<p>This library is free software; you can redistribute it and/or modify it under the terms of the GNU Lesser General Public License as published by the Free Software Foundation; either version 2.1 of the License, or (at your option) any later version.</p>
<p>This library is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more details.</p>
<p>You should have received a copy of the GNU Lesser General Public License along with this library; if not, see <a href="https://www.gnu.org/licenses/">https://www.gnu.org/licenses/</a>.</p>
<p>Also, see the LICENSE.txt file for details on third-party licenses. </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
</div><!-- doc-content -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
